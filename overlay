#!/bin/bash

create() {
    sudo eselect repository create overlay
    rsync -av --delete /var/db/repos/overlay/ overlay/

    pushd overlay
    git init
    git add .
    git commit -m "Hello, world"
    gh repo create
    popd

    sudo eselect repository remove -f overlay
    sudo eselect repository add overlay git https://github.com/notarealdeveloper/overlay
}

update() {
    pkgdev manifest
    pkgcheck scan
}

sync() {
    emaint sync --repo overlay
}

copy() {
    local pkg="$1"
    if [[ -z "$1" ]]; then
        echo "usage: copy category/name"
        return
    fi
    if [[ ! -d /var/db/repos/gentoo/"$1" ]]; then
        echo "couldnt find ebuild directory: $1"
        return
    fi
    dn="$(dirname "$pkg")"
    bn="$(basename "$pkg")"

    mkdir -pv "$dn/$bn"
    cp -rv "/var/db/repos/gentoo/$dn/$bn" "$dn"
}

[ -z "$1" ] && echo "usage: $(basename $0) [create|update|sync]" && exit 1

$@
